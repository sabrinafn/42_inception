# base image
FROM debian:bookworm

# define work dir to run commands in
WORKDIR .

# update packages and install mariadb
RUN apt update \
    && apt upgrade -y \
    && apt install -y mariadb-server mariadb-client \
    && rm -rf /var/lib/apt/lists/*
    
RUN mkdir -p /run/mysqld \
    && chown -R mysql:mysql /run/mysqld \
    && chown -R mysql:mysql /var/lib/mysql

# expose port to receive connections
EXPOSE 3306

# copy config file to docker-entrypoint dir
#COPY /config/entrypoint.sh /script/
COPY /config/init.sql /etc/mysql/init.sql
RUN chmod 644 /etc/mysql/init.sql

# RUN chmod +x /script/entrypoint.sh

USER mysql

# start mariadb from shell script
#ENTRYPOINT ["/script/entrypoint.sh"]
ENTRYPOINT ["mariadbd", "--console", "--init-file=/etc/mysql/init.sql"]